"use strict";const resultsList=document.querySelector(".js-results-list"),inputAnime=document.querySelector(".js-input"),btnSearch=document.querySelector(".js-btn-search"),favoriteList=document.querySelector(".js-favorite-list");let dataAnimes=[],favoritesAnimes=[];onLoadFavoritesLocalStorage();const handleClickSearch=e=>{e.preventDefault(),getDataApi(inputAnime.value.toLowerCase())};function listenerAnimes(){const e=document.querySelectorAll(".js-list-anime");for(const i of e)i.addEventListener("click",handleClickAddFavorite);const i=document.querySelectorAll(".js-title-anime");for(const e of i)e.addEventListener("click",handleClickAddFavorite)}function handleClickAddFavorite(e){const i=parseInt(e.currentTarget.id),t=dataAnimes.find(e=>e.mal_id===i),a=favoritesAnimes.findIndex(e=>e.mal_id===i);-1===a&&favoritesAnimes.push(t),a>=0&&favoritesAnimes.splice(a,1),localStorage.setItem("favorites_anime",JSON.stringify(favoritesAnimes)),renderAnime(),renderFavoriteAnime()}function handleClickRemoveFavorite(e){const i=parseInt(e),t=favoritesAnimes.findIndex(e=>e.mal_id===i);t>=0&&favoritesAnimes.splice(t,1),localStorage.setItem("favorites_anime",JSON.stringify(favoritesAnimes));const a=document.querySelectorAll(".js-list-anime");for(const e of a)parseInt(e.id)===i&&e.classList.remove("favorite-click");const n=document.querySelectorAll(".js-title-anime");for(const e of n)parseInt(e.id)===i&&e.classList.remove("favorite-click-text");renderFavoriteAnime()}function renderAnime(){let e="",i="",t="";for(const a of dataAnimes){let n=animeImage(a);-1!==favoritesAnimes.findIndex(e=>a.mal_id===e.mal_id)?(i="favorite-click",t="favorite-click-text"):(i="",t=""),e+=` <li class="js-list-anime anime__results-list ${i}" id="${a.mal_id}">`,e+=' <div class="js-container-anime anime__results-list-container">',e+=` <h3 class="js-title-anime anime__results-list-title ${t}" id="${a.mal_id}">${a.title}</h3>`,e+=` <img class="anime__results-list-image" src="${n}" alt="Portada de la serie de anime ${a.title}" title="Portada de la serie de anime ${a.title}"/>`,e+="</div></li>"}resultsList.innerHTML=e,listenerAnimes()}function animeImage(e){return"https://cdn.myanimelist.net/img/sp/icon/apple-touch-icon-256.png"===e.images.jpg.image_url?"https://via.placeholder.com/210x295/ffffff/666666/?text=TV":e.images.jpg.image_url}function renderFavoriteAnime(){let e="";for(const i of favoritesAnimes){let t=animeImage(i);e+=` <li class="js-list-favorite anime__favorite-list" id="${i.mal_id}"> <div class="anime__favorite-list-container">`,e+=' <div class="js-container-anime anime__favorite-list-container-li">',e+=`<h3 class="anime__favorite-list-title"  id="${i.mal_id}">${i.title}</h3>`,e+=` <img class="anime__favorite-list-image" src="${t}" alt="Portada de la serie de anime ${i.title}" title="Portada de la serie de anime ${i.title}"/></div>`,e+=`<div onclick="handleClickRemoveFavorite('${i.mal_id}')"><i class="fa-solid fa-trash-can icon"></i></div>`,e+="</div></li>"}favoriteList.innerHTML=e}function onLoadFavoritesLocalStorage(){favoritesAnimes=JSON.parse(localStorage.getItem("favorites_anime")),Array.isArray(favoritesAnimes)||(favoritesAnimes=[]),renderFavoriteAnime(),getDataApi("")}function getDataApi(e){fetch("https://api.jikan.moe/v4/anime?q="+e).then(e=>e.json()).then(e=>{dataAnimes=e.data,renderAnime()})}btnSearch.addEventListener("click",handleClickSearch);const btnReset=document.querySelector(".js-btn-reset");function handleClickReset(e){e.preventDefault(),inputAnime.value="",resultsList.innerHTML="",favoriteList.innerHTML="",localStorage.removeItem("favorites_anime"),favoritesAnimes=[];const i=document.querySelectorAll(".js-list-anime");for(const e of i)e.classList.remove("favorite-click")}btnReset.addEventListener("click",handleClickReset);